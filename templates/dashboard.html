<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GitHub Profile Explorer</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
    rel="stylesheet"
    href="{{ url_for('static', filename='light.css') }}"
  />
  <link
  rel="stylesheet"
  href="{{ url_for('static', filename='sidebar.css') }}"
/>
<link
rel="stylesheet"
href="{{ url_for('static', filename='navbar.css') }}"
/>
<link
rel="stylesheet"
href="{{ url_for('static', filename='button.css') }}"
/>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
  </head>
  <body class="light">
    <nav class="navbar">
      <div class="nav-content">
        <div class="nav-left">
          <i class="fa-brands fa-github"></i>
          <span class="nav-title">GitHub Profile Explorer</span>
        </div>
        <div class="nav-right">
          <button class="hamburger"><i class="fa-solid fa-bars"></i></button>
        </div>
      </div>
      <div class="user-info">
        <h2 class="name">{{ user_data.name }}</h2>
        <p class="username">@{{ user_data.username }}</p>
        <p class="bio">{{ user_data.bio if user_data.bio else user_data.username + ' has no bio' }}</p>

      {% if user_data %}
      <aside class="sidebar">
        <div class="profile">
          
          <div class="profile-pic">
            <img
              src="{{ user_data.porfile_pic }}"
              alt="Avatar"
              class="avatar"
            />
          </div>
          <div class="user-info">
            <h2 class="name">{{ user_data.name }}</h2>
            <p class="username">@{{ user_data.username }}</p>
            <p class="bio">{{ user_data.bio if user_data.bio else user_data.username + ' has no bio' }}</p>

            <div class="details">
              <p>
                <i class="fa-solid fa-location-dot"></i> San Jose State
                University
              </p>
              <p>
                <i class="fa-brands fa-linkedin"></i>
                <a href="https://linkedin.com/in/kmoradpour" target="_blank"
                  >in/kmoradpour</a
                >
              </p>
              <p>
                <i class="fa-solid fa-link"></i>
                <a href="https://khashayarmoradpour.com" target="_blank"
                  >Website</a
                >
              </p>
            </div>
            {% if profession_summary %}
            <div class="summary-box">
                <h3>AI Summary</h3>
                <p style="font-size: 0.9rem; color: #0c0b0b; line-height: 1.4;">
                    <span id="typed-summary">{{ profession_summary }}</span>
                </p>
            </div>
            {% endif %}
          </div>
         
        </div>
        {% if profession_summary %}
        <div class="summary-box">
          <h3>AI Summary</h3>
          <p style="font-size: 0.9rem; color: #ccc; line-height: 1.4;">
            <span id="typed-summary">{{ profession_summary }}</span>
          </p>
        </div>
        {% endif %}
      </main>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/github-calendar@2.1.3/dist/github-calendar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const form = document.querySelector('form');
      const loading = document.getElementById('loading');
  
      form.addEventListener('submit', () => {
          loading.style.display = 'block';
      });
  
      {% if profession_summary %}
      document.addEventListener('DOMContentLoaded', function() {
          const typed = new Typed('#typed-summary', {
              strings: ["{{ profession_summary|replace('\n', '\\n') }}"],
              typeSpeed: 10,
              backSpeed: 0,
              loop: false
          });
      });
      {% endif %}
  </script>
    {% if user_data and contribution_data %}
    <script>
      const contributionData = {{ contribution_data|tojson }};
      const calendarContainer = document.querySelector("#github-calendar");

      const contributionsByDate = {};
      if (contributionData && contributionData.weeks) {
          contributionData.weeks.forEach(week => {
              week.contributionDays.forEach(day => {
                  contributionsByDate[day.date] = day.contributionCount;
              });
          });
      }

      GitHubCalendar(calendarContainer, "{{ user_data.username }}", {
          data: contributionsByDate,
          tooltips: true,
          responsive: true,
          theme: 'dark' 
      });
    </script>

    </div>
  </aside>
  {% endif %}
  <!-- Main Dashboard -->
  <main class="main">
    <header>

    {% endif %} 
    
    
    {% if languages %}
    <script>
const ctx = document.getElementById('langChart').getContext('2d');
const langChart = new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: {{ languages.keys()|list|tojson }},
    datasets: [{
      label: 'Repos by Language',
      data: {{ languages.values()|list|tojson }},
      backgroundColor: [
        '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728',
        '#9467bd', '#8c564b', '#e377c2', '#7f7f7f',
        '#bcbd22', '#17becf'
      ],
      borderColor: '#ffffff',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        display: true,
        position: 'bottom',
        labels: {
          color: '#24292f', // label text color for light background
          font: {
            size: 12
          }
        }
      },
      tooltip: {
        callbacks: {
          label: function (context) {
            const label = context.label || '';
            const value = context.parsed || 0;
            return `${label}: ${value.toLocaleString()} lines`;
          }
        }
      }
    }
  }
});

    </script>
    {% endif %}
    {% if monthly_commits %}
<script>
const commitCtx = document.getElementById('commitChart').getContext('2d');
const commitChart = new Chart(commitCtx, {
  type: 'bar',
  data: {
    labels: {{ monthly_commits.keys()|list|tojson }},
    datasets: [{
      label: 'Commits per Month',
      data: {{ monthly_commits.values()|list|tojson }},
      backgroundColor: [
        '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728',
        '#9467bd', '#8c564b', '#e377c2', '#7f7f7f',
        '#bcbd22', '#17becf', '#ffbb78', '#98df8a'
      ]
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        labels: {
          color: '#24292f'
        }
      }
    },
    scales: {
      x: {
        title: {
          display: true,
          text: 'Month',
          color: '#24292f'
        },
        ticks: {
          color: '#24292f'
        }
      },
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'Number of Commits',
          color: '#24292f'
        },
        ticks: {
          color: '#24292f'
        }
      }
    }
  }
});

</script>
{% endif %}
-->

{% if language_timeseries %}
<script>
  const ctxNew = document.getElementById('language_timeseries_plot');
  const plotData = {{ language_timeseries }};
  const languagePlot = new Chart(ctxNew, {
    type: 'line',
    data: plotData,
    options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'top',
      },
      title: {
        display: true,
        text: 'Language Timeseries'
      }
    }
  },
  });
</script>
{% endif %}

<script>
  const form = document.querySelector('form');
  const loading = document.getElementById('loading');

  form.addEventListener('submit', () => {
    loading.style.display = 'block';
  });
</script>
</body>
</html>
